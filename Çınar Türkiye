import random
import time
import sys
import os

# ANSI renk kodlarÄ±
class Colors:
    RESET = "\033[0m"
    RED = "\033[91m"
    GREEN = "\033[92m"
    YELLOW = "\033[93m"
    BLUE = "\033[94m"
    MAGENTA = "\033[95m"
    CYAN = "\033[96m"
    WHITE = "\033[97m"
    BG_BLACK = "\033[40m"
    BG_RED = "\033[41m"
    BG_GREEN = "\033[42m"
    BG_YELLOW = "\033[43m"
    BRIGHT_BLACK = "\033[90m"
    BRIGHT_WHITE = "\033[97m"

# --- YardÄ±mcÄ± Fonksiyonlar ---
def clear_screen():
    """Terminal ekranÄ±nÄ± temizler."""
    os.system('cls' if os.name == 'nt' else 'clear')

def print_slowly(text, delay=0.03):
    """Metni yavaÅŸÃ§a, harf harf yazdÄ±rÄ±r."""
    for char in text:
        sys.stdout.write(char)
        sys.stdout.flush()
        time.sleep(delay)
    print()

def display_can_bar(current_can, max_can):
    """Kalan canÄ± gÃ¶rsel bir bar ÅŸeklinde gÃ¶sterir."""
    bar = ""
    for i in range(max_can):
        if i < current_can:
            bar += Colors.RED + "â™¥ " + Colors.RESET # Can var
        else:
            bar += Colors.WHITE + "â™¡ " + Colors.RESET # Can yok
    print(f"Can: [{bar}] ({current_can}/{max_can})")

def draw_frame(title, content_func, color=Colors.CYAN):
    """Belirtilen iÃ§eriÄŸi bir Ã§erÃ§eve iÃ§ine alarak gÃ¶sterir."""
    clear_screen()
    width = 60
    print(color + "â•”" + "â•" * (width - 2) + "â•—" + Colors.RESET)
    print(color + "â•‘" + title.center(width - 2) + "â•‘" + Colors.RESET)
    print(color + "â• " + "â•" * (width - 2) + "â•£" + Colors.RESET)

    # Ä°Ã§eriÄŸi fonksiyon Ã§aÄŸÄ±rarak yazdÄ±r
    content_func()

    print(color + "â•š" + "â•" * (width - 2) + "â•" + Colors.RESET)
    print(Colors.RESET) # Renk sÄ±fÄ±rlama

# --- Oyun Ä°statistikleri FonksiyonlarÄ± ---
STATS_FILE = "bomba_oyunu_istatistikleri.txt"

def load_stats():
    """KayÄ±tlÄ± istatistikleri dosyadan yÃ¼kler."""
    stats = {"wins": 0, "losses": 0}
    if os.path.exists(STATS_FILE):
        try:
            with open(STATS_FILE, "r") as f:
                for line in f:
                    if "KazanÄ±lan:" in line:
                        stats["wins"] = int(line.split(":")[1].strip())
                    elif "Kaybedilen:" in line:
                        stats["losses"] = int(line.split(":")[1].strip())
        except Exception as e:
            print(Colors.RED + f"Ä°statistikler yÃ¼klenirken bir hata oluÅŸtu: {e}" + Colors.RESET)
    return stats

def save_stats(stats):
    """Ä°statistikleri dosyaya kaydeder."""
    try:
        with open(STATS_FILE, "w") as f:
            f.write(f"KazanÄ±lan: {stats['wins']}\n")
            f.write(f"Kaybedilen: {stats['losses']}\n")
    except Exception as e: # Bu kÄ±sÄ±m Ã¶nceki hatada dÃ¼zeltilmiÅŸti.
        print(Colors.RED + f"Ä°statistikler kaydedilirken bir hata oluÅŸtu: {e}" + Colors.RESET)

def show_stats_content(stats):
    """Ä°statistik iÃ§eriÄŸini Ã§erÃ§eve iÃ§ine yazdÄ±rÄ±r."""
    print(Colors.GREEN + f"Toplam KazanÄ±lan Oyun: {stats['wins']}".ljust(58) + Colors.RESET)
    print(Colors.RED + f"Toplam Kaybedilen Oyun: {stats['losses']}".ljust(58) + Colors.RESET)
    total_games = stats['wins'] + stats['losses']
    if total_games > 0:
        kazanma_orani = (stats['wins'] / total_games) * 100
        print(Colors.YELLOW + f"Kazanma OranÄ±: %{kazanma_orani:.2f}".ljust(58) + Colors.RESET)
    else:
        print(Colors.MAGENTA + "HenÃ¼z hiÃ§ oyun oynanmadÄ±.".ljust(58) + Colors.RESET)
    print(" " * 58) # BoÅŸluk
    input(Colors.BLUE + "Devam etmek iÃ§in ENTER tuÅŸuna bas...".ljust(58) + Colors.RESET)

# --- Oyun SenaryolarÄ± ---
def display_splash_screen():
    """Oyunun aÃ§Ä±lÄ±ÅŸ ekranÄ±nÄ± gÃ¶sterir."""
    clear_screen()
    print(Colors.BG_BLACK + Colors.YELLOW + r"""
                                         _  _       _
                                        | || |     | |
                                        | || |_   _| |__  _ __ ___   __ _ _ __
                                        |__   _| / _` | '_ \| '_ ` _ \ / _` | '_ \
                                           | |  | (_| | |_) | | | | | | (_| | | | |
                                           |_|   \__,_|_.__|_| |_| |_|\__,_|_| |_|

          ____                      _
         |  _ \                    | |
         | |_) | ___  _ __ ___   __| | ___ _ __
         |  _ < / _ \| '_ ` _ \ / _` |/ _ \ '__|
         | |_) | (_) | | | | | | (_| |  __/ |
         |____/ \___|_| |_| |_| |_|\__,_|\___|_|
            """ + Colors.RESET)

    print_slowly(Colors.CYAN + "         YÃ¼kleniyor..." + Colors.RESET, delay=0.08)
    time.sleep(0.5)
    print_slowly(Colors.MAGENTA + "         HazÄ±rlanÄ±yor..." + Colors.RESET, delay=0.08)
    time.sleep(0.5)
    print_slowly(Colors.GREEN + "         BaÅŸlatÄ±lÄ±yor..." + Colors.RESET, delay=0.08)
    time.sleep(1) # KÄ±sa bir duraklama
    clear_screen()

def oyun_karsilama_content():
    """Ana menÃ¼deki karÅŸÄ±lama iÃ§eriÄŸini yazdÄ±rÄ±r."""
    print_slowly("        GELÄ°ÅžTÄ°RÄ°LMÄ°Åž BOMBA KAZANMA SÄ°STEMÄ°NE HOÅž GELDÄ°N! ", delay=0.04)
    print_slowly("--------------------------------------------------")
    print(" " * 58) # BoÅŸluk
    print(Colors.BRIGHT_BLACK + "        HazÄ±r Ol, Zaman DaralÄ±yor!" + Colors.RESET)


def how_to_play_content():
    """NasÄ±l oynanÄ±r iÃ§eriÄŸini Ã§erÃ§eve iÃ§ine yazdÄ±rÄ±r."""
    print_slowly("AmacÄ±n belirlenen sayÄ± aralÄ±ÄŸÄ±nda bir sayÄ± tahmin etmek.".ljust(58), delay=0.01)
    print_slowly("Her yanlÄ±ÅŸ tahminde bir can kaybedersin.".ljust(58), delay=0.01)
    print_slowly("DoÄŸru sayÄ±yÄ± bulursan KAZANIRSIN!".ljust(58), delay=0.01)
    print_slowly("CanÄ±n biterse, BOMBA PATLAR ve KAYBEDERSÄ°N!".ljust(58), delay=0.01)
    print_slowly("Oyunda 3 zorluk seviyesi bulunur.".ljust(58), delay=0.01)
    print_slowly("Her seviyenin farklÄ± bir sayÄ± aralÄ±ÄŸÄ± ve can hakkÄ± vardÄ±r.".ljust(58), delay=0.01)
    print_slowly("Tahminlerine gÃ¶re ipuÃ§larÄ± alacaksÄ±n.".ljust(58), delay=0.01)
    print(" " * 58) # BoÅŸluk
    input(Colors.BLUE + "Devam etmek iÃ§in ENTER tuÅŸuna bas...".ljust(58) + Colors.RESET)

def zorluk_secimi():
    """KullanÄ±cÄ±dan zorluk seviyesi seÃ§mesini ister ve aralÄ±ÄŸÄ± dÃ¶ndÃ¼rÃ¼r."""
    while True:
        clear_screen() # SeÃ§im ekranÄ±nÄ± temizle
        print(Colors.BLUE + "\n--- Zorluk Seviyesi SeÃ§ ---" + Colors.RESET)
        print("1. Kolay " + Colors.GREEN + "(1-20 arasÄ±, 5 can)" + Colors.RESET)
        print("2. Orta " + Colors.YELLOW + "(1-50 arasÄ±, 4 can)" + Colors.RESET)
        print("3. Zor " + Colors.RED + "(1-100 arasÄ±, 3 can)" + Colors.RESET)
        secim = input(Colors.CYAN + "SeÃ§imin (1/2/3): " + Colors.RESET)

        if secim == '1':
            return 1, 20, 5 # min, max, can
        elif secim == '2':
            return 1, 50, 4
        elif secim == '3':
            return 1, 100, 3
        else:
            print(Colors.RED + "GeÃ§ersiz seÃ§im. LÃ¼tfen 1, 2 veya 3 girin." + Colors.RESET)
            time.sleep(0.5)

def bomba_patlama_animasyonu():
    """Bomba patlama anÄ±nÄ± metinle canlandÄ±rÄ±r."""
    sys.stdout.write(Colors.BG_RED + Colors.WHITE)
    sys.stdout.flush()
    print("\n     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     ")
    print("    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    ")
    print("   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   ")
    print("   â–ˆâ–ˆâ–ˆ" + Colors.RED + "BOM" + Colors.WHITE + "BA" + Colors.RED + "PAT" + Colors.WHITE + "LADI" + Colors.RED + "DII" + Colors.WHITE + "â–ˆâ–ˆâ–ˆ   ")
    print("   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   ")
    print("    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    ")
    print("     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     ")
    print("\n       ðŸ’¥ B O O M ! ðŸ’¥       ")
    time.sleep(1.5)
    sys.stdout.write(Colors.BG_BLACK + Colors.RESET) # Arka planÄ± siyaha dÃ¶ndÃ¼r
    sys.stdout.flush()

def kazanma_animasyonu():
    """Kazanma anÄ±nÄ± metinle canlandÄ±rÄ±r."""
    sys.stdout.write(Colors.BG_GREEN + Colors.WHITE)
    sys.stdout.flush()
    print("\n     ðŸŽ‰ TEBRÄ°KLER! ðŸŽ‰     ")
    print("    âœ¨ KAZANDINIZ! âœ¨    ")
    print("     ðŸ† MÃœKEMMEL! ðŸ†     ")
    time.sleep(1.5)
    sys.stdout.write(Colors.BG_BLACK + Colors.RESET) # Arka planÄ± siyaha dÃ¶ndÃ¼r
    sys.stdout.flush()

def get_hint(tahmin, gizli_sayi, max_range_param): # Parametre adÄ± deÄŸiÅŸtirildi
    """Tahmine gÃ¶re daha detaylÄ± ipucu verir."""
    fark = abs(tahmin - gizli_sayi)

    # max_range yerine max_range_param kullanÄ±yoruz
    if max_range_param <= 20: # Kolay seviye
        if fark <= 2:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 5:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET
    elif max_range_param <= 50: # Orta seviye
        if fark <= 5:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 10:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET
    else: # Zor seviye
        if fark <= 10:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 20:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET

# --- Ana Oyun DÃ¶ngÃ¼sÃ¼ ---
def play_game(stats):
    """Tek bir oyunun akÄ±ÅŸÄ±nÄ± yÃ¶netir."""
    clear_screen()
    min_sayi, max_sayi, baslangic_can = zorluk_secimi()
    gizli_sayi = random.randint(min_sayi, max_sayi)
    can = baslangic_can
    tahmin_hakki = 0

    print(Colors.BLUE + f"\n{min_sayi} ile {max_sayi} arasÄ±nda bir sayÄ± tahmin et." + Colors.RESET)

    while can > 0:
        display_can_bar(can, baslangic_can) # Can barÄ±nÄ± gÃ¶ster
        try:
            tahmin_hakki += 1
            tahmin = int(input(Colors.YELLOW + f"Tahminini gir: " + Colors.RESET))

            if not (min_sayi <= tahmin <= max_sayi):
                print(Colors.RED + f"LÃ¼tfen {min_sayi} ile {max_sayi} arasÄ±nda bir sayÄ± gir." + Colors.RESET)
                time.sleep(0.5)
                continue

            if tahmin == gizli_sayi:
                kazanma_animasyonu() # Kazanma animasyonu
                print(Colors.GREEN + f"     {tahmin_hakki} tahminde doÄŸru bildin! Gizli sayÄ± {gizli_sayi} idi." + Colors.RESET)
                stats["wins"] += 1
                break
            else:
                can -= 1
                print_slowly(Colors.MAGENTA + "YanlÄ±ÅŸ tahmin! Bomba tÄ±k tÄ±k ediyor..." + Colors.RESET, delay=0.05)
                time.sleep(0.5) # KÄ±sa bir duraklama
                if can > 0:
                    print(get_hint(tahmin, gizli_sayi, max_sayi)) # <-- Buradaki max_sayi dÃ¼zeltildi!
                    if tahmin < gizli_sayi:
                        print(Colors.BLUE + "SayÄ± daha bÃ¼yÃ¼k." + Colors.RESET)
                    else:
                        print(Colors.BLUE + "SayÄ± daha kÃ¼Ã§Ã¼k." + Colors.RESET)
                else:
                    bomba_patlama_animasyonu() # Patlama animasyonu
                    print(Colors.RED + f"     Kaybettin! Gizli sayÄ± {gizli_sayi} idi." + Colors.RESET)
                    stats["losses"] += 1
        except ValueError:
            print(Colors.RED + "GeÃ§ersiz giriÅŸ! LÃ¼tfen bir sayÄ± gir." + Colors.RESET)
            time.sleep(0.5)
        except Exception as e:
            print(Colors.RED + f"Beklenmeyen bir hata oluÅŸtu: {e}" + Colors.RESET)
            time.sleep(0.5)

        # Bu input'un yeri deÄŸiÅŸti, artÄ±k her tahmin sonrasÄ± deÄŸil, can bittiÄŸinde veya kazanÄ±ldÄ±ÄŸÄ±nda gelecek.
        # BÃ¶ylece dÃ¶ngÃ¼de gereksiz duraklama olmaz.
        if can <= 0 or tahmin == gizli_sayi: # Oyun bittiÄŸinde
            input(Colors.BLUE + "\nDevam etmek iÃ§in ENTER tuÅŸuna bas..." + Colors.RESET)
            clear_screen()
            save_stats(stats) # Oyun bitince istatistikleri kaydet


# --- Ana MenÃ¼ ---
def main_menu():
    """Oyunun ana menÃ¼sÃ¼nÃ¼ gÃ¶sterir ve kullanÄ±cÄ± seÃ§imlerini yÃ¶netir."""
    stats = load_stats() # Ä°statistikleri baÅŸlangÄ±Ã§ta yÃ¼kle

    # Oyun baÅŸlamadan Ã¶nce aÃ§Ä±lÄ±ÅŸ ekranÄ±nÄ± gÃ¶ster
    display_splash_screen()

    while True:
        # MenÃ¼yÃ¼ bir Ã§erÃ§eve iÃ§inde Ã§izelim
        def menu_options_content():
            print(Colors.GREEN + "1. Oyuna BaÅŸla".ljust(58) + Colors.RESET)
            print(Colors.CYAN + "2. Ä°statistikleri GÃ¶r".ljust(58) + Colors.RESET)
            print(Colors.BLUE + "3. NasÄ±l OynanÄ±r?".ljust(58) + Colors.RESET)
            print(Colors.RED + "4. Ã‡Ä±kÄ±ÅŸ".ljust(58) + Colors.RESET)
            print("\n" + Colors.BRIGHT_BLACK + "Kontrol Paneli V1.2".rjust(58) + Colors.RESET) # Alt bilgi

        # Ana menÃ¼yÃ¼ Ã§izmeden Ã¶nce hoÅŸ geldin iÃ§eriÄŸini gÃ¶sterelim
        draw_frame("ANA MENÃœ", lambda: oyun_karsilama_content(), Colors.CYAN)
        # ArdÄ±ndan menÃ¼ seÃ§eneklerini ve input'u alalÄ±m
        draw_frame("ANA MENÃœ", lambda: menu_options_content(), Colors.CYAN)


        secim = input(Colors.YELLOW + "SeÃ§imin: " + Colors.RESET).strip()

        if secim == '1':
            play_game(stats)
        elif secim == '2':
            draw_frame("OYUN Ä°STATÄ°STÄ°KLERÄ°", lambda: show_stats_content(stats), Colors.CYAN)
        elif secim == '3':
            draw_frame("NASIL OynanÄ±r?", how_to_play_content, Colors.BLUE)
        elif secim == '4':
            clear_screen()
            print_slowly(Colors.WHITE + "\nGÃ¼le gÃ¼le! Tekrar bekleriz. ðŸš€" + Colors.RESET, delay=0.05)
            break
        else:
            clear_screen()
            print(Colors.RED + "GeÃ§ersiz seÃ§im. LÃ¼tfen 1, 2, 3 veya 4 girin." + Colors.RESET)
            time.sleep(1)
            clear_screen()

# Oyunu baÅŸlat
if __name__ == "__main__":
    clear_screen() # Program baÅŸlangÄ±cÄ±nda ekranÄ± temizle
    sys.stdout.write(Colors.BG_BLACK) # Terminal arka planÄ±nÄ± siyaha ayarla (EÄŸer destekleniyorsa)
    sys.stdout.flush()
    main_menu()
    sys.stdout.write(Colors.RESET) # Ã‡Ä±kÄ±ÅŸta renkleri sÄ±fÄ±rla
    sys.stdout.flush()
    import random
import time
import sys
import os

# ANSI renk kodlarÄ±
class Colors:
    RESET = "\033[0m"
    RED = "\033[91m"
    GREEN = "\033[92m"
    YELLOW = "\033[93m"
    BLUE = "\033[94m"
    MAGENTA = "\033[95m"
    CYAN = "\033[96m"
    WHITE = "\033[97m"
    BG_BLACK = "\033[40m"
    BG_RED = "\033[41m"
    BG_GREEN = "\033[42m"
    BG_YELLOW = "\033[43m"
    BRIGHT_BLACK = "\033[90m"
    BRIGHT_WHITE = "\033[97m"

# --- YardÄ±mcÄ± Fonksiyonlar ---
def clear_screen():
    """Terminal ekranÄ±nÄ± temizler."""
    os.system('cls' if os.name == 'nt' else 'clear')

def print_slowly(text, delay=0.03):
    """Metni yavaÅŸÃ§a, harf harf yazdÄ±rÄ±r."""
    for char in text:
        sys.stdout.write(char)
        sys.stdout.flush()
        time.sleep(delay)
    print()

def display_can_bar(current_can, max_can):
    """Kalan canÄ± gÃ¶rsel bir bar ÅŸeklinde gÃ¶sterir."""
    bar = ""
    for i in range(max_can):
        if i < current_can:
            bar += Colors.RED + "â™¥ " + Colors.RESET # Can var
        else:
            bar += Colors.WHITE + "â™¡ " + Colors.RESET # Can yok
    print(f"Can: [{bar}] ({current_can}/{max_can})")

def draw_frame(title, content_func, color=Colors.CYAN):
    """Belirtilen iÃ§eriÄŸi bir Ã§erÃ§eve iÃ§ine alarak gÃ¶sterir."""
    clear_screen()
    width = 60
    print(color + "â•”" + "â•" * (width - 2) + "â•—" + Colors.RESET)
    print(color + "â•‘" + title.center(width - 2) + "â•‘" + Colors.RESET)
    print(color + "â• " + "â•" * (width - 2) + "â•£" + Colors.RESET)

    # Ä°Ã§eriÄŸi fonksiyon Ã§aÄŸÄ±rarak yazdÄ±r
    content_func()

    print(color + "â•š" + "â•" * (width - 2) + "â•" + Colors.RESET)
    print(Colors.RESET) # Renk sÄ±fÄ±rlama

# --- Oyun Ä°statistikleri FonksiyonlarÄ± ---
STATS_FILE = "bomba_oyunu_istatistikleri.txt"

def load_stats():
    """KayÄ±tlÄ± istatistikleri dosyadan yÃ¼kler."""
    stats = {"wins": 0, "losses": 0}
    if os.path.exists(STATS_FILE):
        try:
            with open(STATS_FILE, "r") as f:
                for line in f:
                    if "KazanÄ±lan:" in line:
                        stats["wins"] = int(line.split(":")[1].strip())
                    elif "Kaybedilen:" in line:
                        stats["losses"] = int(line.split(":")[1].strip())
        except Exception as e:
            print(Colors.RED + f"Ä°statistikler yÃ¼klenirken bir hata oluÅŸtu: {e}" + Colors.RESET)
    return stats

def save_stats(stats):
    """Ä°statistikleri dosyaya kaydeder."""
    try:
        with open(STATS_FILE, "w") as f:
            f.write(f"KazanÄ±lan: {stats['wins']}\n")
            f.write(f"Kaybedilen: {stats['losses']}\n")
    except Exception as e: # Bu kÄ±sÄ±m Ã¶nceki hatada dÃ¼zeltilmiÅŸti.
        print(Colors.RED + f"Ä°statistikler kaydedilirken bir hata oluÅŸtu: {e}" + Colors.RESET)

def show_stats_content(stats):
    """Ä°statistik iÃ§eriÄŸini Ã§erÃ§eve iÃ§ine yazdÄ±rÄ±r."""
    print(Colors.GREEN + f"Toplam KazanÄ±lan Oyun: {stats['wins']}".ljust(58) + Colors.RESET)
    print(Colors.RED + f"Toplam Kaybedilen Oyun: {stats['losses']}".ljust(58) + Colors.RESET)
    total_games = stats['wins'] + stats['losses']
    if total_games > 0:
        kazanma_orani = (stats['wins'] / total_games) * 100
        print(Colors.YELLOW + f"Kazanma OranÄ±: %{kazanma_orani:.2f}".ljust(58) + Colors.RESET)
    else:
        print(Colors.MAGENTA + "HenÃ¼z hiÃ§ oyun oynanmadÄ±.".ljust(58) + Colors.RESET)
    print(" " * 58) # BoÅŸluk
    input(Colors.BLUE + "Devam etmek iÃ§in ENTER tuÅŸuna bas...".ljust(58) + Colors.RESET)

# --- Oyun SenaryolarÄ± ---
def display_splash_screen():
    """Oyunun aÃ§Ä±lÄ±ÅŸ ekranÄ±nÄ± gÃ¶sterir."""
    clear_screen()
    print(Colors.BG_BLACK + Colors.YELLOW + r"""
                                         _  _       _
                                        | || |     | |
                                        | || |_   _| |__  _ __ ___   __ _ _ __
                                        |__   _| / _` | '_ \| '_ ` _ \ / _` | '_ \
                                           | |  | (_| | |_) | | | | | | (_| | | | |
                                           |_|   \__,_|_.__|_| |_| |_|\__,_|_| |_|

          ____                      _
         |  _ \                    | |
         | |_) | ___  _ __ ___   __| | ___ _ __
         |  _ < / _ \| '_ ` _ \ / _` |/ _ \ '__|
         | |_) | (_) | | | | | | (_| |  __/ |
         |____/ \___|_| |_| |_| |_|\__,_|\___|_|
            """ + Colors.RESET)

    print_slowly(Colors.CYAN + "         YÃ¼kleniyor..." + Colors.RESET, delay=0.08)
    time.sleep(0.5)
    print_slowly(Colors.MAGENTA + "         HazÄ±rlanÄ±yor..." + Colors.RESET, delay=0.08)
    time.sleep(0.5)
    print_slowly(Colors.GREEN + "         BaÅŸlatÄ±lÄ±yor..." + Colors.RESET, delay=0.08)
    time.sleep(1) # KÄ±sa bir duraklama
    clear_screen()

def oyun_karsilama_content():
    """Ana menÃ¼deki karÅŸÄ±lama iÃ§eriÄŸini yazdÄ±rÄ±r."""
    print_slowly("        GELÄ°ÅžTÄ°RÄ°LMÄ°Åž BOMBA KAZANMA SÄ°STEMÄ°NE HOÅž GELDÄ°N! ", delay=0.04)
    print_slowly("--------------------------------------------------")
    print(" " * 58) # BoÅŸluk
    print(Colors.BRIGHT_BLACK + "        HazÄ±r Ol, Zaman DaralÄ±yor!" + Colors.RESET)


def how_to_play_content():
    """NasÄ±l oynanÄ±r iÃ§eriÄŸini Ã§erÃ§eve iÃ§ine yazdÄ±rÄ±r."""
    print_slowly("AmacÄ±n belirlenen sayÄ± aralÄ±ÄŸÄ±nda bir sayÄ± tahmin etmek.".ljust(58), delay=0.01)
    print_slowly("Her yanlÄ±ÅŸ tahminde bir can kaybedersin.".ljust(58), delay=0.01)
    print_slowly("DoÄŸru sayÄ±yÄ± bulursan KAZANIRSIN!".ljust(58), delay=0.01)
    print_slowly("CanÄ±n biterse, BOMBA PATLAR ve KAYBEDERSÄ°N!".ljust(58), delay=0.01)
    print_slowly("Oyunda 3 zorluk seviyesi bulunur.".ljust(58), delay=0.01)
    print_slowly("Her seviyenin farklÄ± bir sayÄ± aralÄ±ÄŸÄ± ve can hakkÄ± vardÄ±r.".ljust(58), delay=0.01)
    print_slowly("Tahminlerine gÃ¶re ipuÃ§larÄ± alacaksÄ±n.".ljust(58), delay=0.01)
    print(" " * 58) # BoÅŸluk
    input(Colors.BLUE + "Devam etmek iÃ§in ENTER tuÅŸuna bas...".ljust(58) + Colors.RESET)

def zorluk_secimi():
    """KullanÄ±cÄ±dan zorluk seviyesi seÃ§mesini ister ve aralÄ±ÄŸÄ± dÃ¶ndÃ¼rÃ¼r."""
    while True:
        clear_screen() # SeÃ§im ekranÄ±nÄ± temizle
        print(Colors.BLUE + "\n--- Zorluk Seviyesi SeÃ§ ---" + Colors.RESET)
        print("1. Kolay " + Colors.GREEN + "(1-20 arasÄ±, 5 can)" + Colors.RESET)
        print("2. Orta " + Colors.YELLOW + "(1-50 arasÄ±, 4 can)" + Colors.RESET)
        print("3. Zor " + Colors.RED + "(1-100 arasÄ±, 3 can)" + Colors.RESET)
        secim = input(Colors.CYAN + "SeÃ§imin (1/2/3): " + Colors.RESET)

        if secim == '1':
            return 1, 20, 5 # min, max, can
        elif secim == '2':
            return 1, 50, 4
        elif secim == '3':
            return 1, 100, 3
        else:
            print(Colors.RED + "GeÃ§ersiz seÃ§im. LÃ¼tfen 1, 2 veya 3 girin." + Colors.RESET)
            time.sleep(0.5)

def bomba_patlama_animasyonu():
    """Bomba patlama anÄ±nÄ± metinle canlandÄ±rÄ±r."""
    sys.stdout.write(Colors.BG_RED + Colors.WHITE)
    sys.stdout.flush()
    print("\n     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     ")
    print("    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    ")
    print("   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   ")
    print("   â–ˆâ–ˆâ–ˆ" + Colors.RED + "BOM" + Colors.WHITE + "BA" + Colors.RED + "PAT" + Colors.WHITE + "LADI" + Colors.RED + "DII" + Colors.WHITE + "â–ˆâ–ˆâ–ˆ   ")
    print("   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   ")
    print("    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    ")
    print("     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     ")
    print("\n       ðŸ’¥ B O O M ! ðŸ’¥       ")
    time.sleep(1.5)
    sys.stdout.write(Colors.BG_BLACK + Colors.RESET) # Arka planÄ± siyaha dÃ¶ndÃ¼r
    sys.stdout.flush()

def kazanma_animasyonu():
    """Kazanma anÄ±nÄ± metinle canlandÄ±rÄ±r."""
    sys.stdout.write(Colors.BG_GREEN + Colors.WHITE)
    sys.stdout.flush()
    print("\n     ðŸŽ‰ TEBRÄ°KLER! ðŸŽ‰     ")
    print("    âœ¨ KAZANDINIZ! âœ¨    ")
    print("     ðŸ† MÃœKEMMEL! ðŸ†     ")
    time.sleep(1.5)
    sys.stdout.write(Colors.BG_BLACK + Colors.RESET) # Arka planÄ± siyaha dÃ¶ndÃ¼r
    sys.stdout.flush()

def get_hint(tahmin, gizli_sayi, max_range_param): # Parametre adÄ± deÄŸiÅŸtirildi
    """Tahmine gÃ¶re daha detaylÄ± ipucu verir."""
    fark = abs(tahmin - gizli_sayi)

    # max_range yerine max_range_param kullanÄ±yoruz
    if max_range_param <= 20: # Kolay seviye
        if fark <= 2:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 5:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET
    elif max_range_param <= 50: # Orta seviye
        if fark <= 5:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 10:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET
    else: # Zor seviye
        if fark <= 10:
            return Colors.RED + "Ä°pucu: Ã‡ok SÄ±cak! Neredeyse buldun." + Colors.RESET
        elif fark <= 20:
            return Colors.YELLOW + "Ä°pucu: SÄ±cak! YaklaÅŸÄ±yorsun." + Colors.RESET
        else:
            return Colors.BLUE + "Ä°pucu: SoÄŸuk! Daha fazla dene." + Colors.RESET

# --- Ana Oyun DÃ¶ngÃ¼sÃ¼ ---
def play_game(stats):
    """Tek bir oyunun akÄ±ÅŸÄ±nÄ± yÃ¶netir."""
    clear_screen()
    min_sayi, max_sayi, baslangic_can = zorluk_secimi()
    gizli_sayi = random.randint(min_sayi, max_sayi)
    can = baslangic_can
    tahmin_hakki = 0

    print(Colors.BLUE + f"\n{min_sayi} ile {max_sayi} arasÄ±nda bir sayÄ± tahmin et." + Colors.RESET)

    while can > 0:
        display_can_bar(can, baslangic_can) # Can barÄ±nÄ± gÃ¶ster
        try:
            tahmin_hakki += 1
            tahmin = int(input(Colors.YELLOW + f"Tahminini gir: " + Colors.RESET))

            if not (min_sayi <= tahmin <= max_sayi):
                print(Colors.RED + f"LÃ¼tfen {min_sayi} ile {max_sayi} arasÄ±nda bir sayÄ± gir." + Colors.RESET)
                time.sleep(0.5)
                continue

            if tahmin == gizli_sayi:
                kazanma_animasyonu() # Kazanma animasyonu
                print(Colors.GREEN + f"     {tahmin_hakki} tahminde doÄŸru bildin! Gizli sayÄ± {gizli_sayi} idi." + Colors.RESET)
                stats["wins"] += 1
                break
            else:
                can -= 1
                print_slowly(Colors.MAGENTA + "YanlÄ±ÅŸ tahmin! Bomba tÄ±k tÄ±k ediyor..." + Colors.RESET, delay=0.05)
                time.sleep(0.5) # KÄ±sa bir duraklama
                if can > 0:
                    print(get_hint(tahmin, gizli_sayi, max_sayi)) # <-- Buradaki max_sayi dÃ¼zeltildi!
                    if tahmin < gizli_sayi:
                        print(Colors.BLUE + "SayÄ± daha bÃ¼yÃ¼k." + Colors.RESET)
                    else:
                        print(Colors.BLUE + "SayÄ± daha kÃ¼Ã§Ã¼k." + Colors.RESET)
                else:
                    bomba_patlama_animasyonu() # Patlama animasyonu
                    print(Colors.RED + f"     Kaybettin! Gizli sayÄ± {gizli_sayi} idi." + Colors.RESET)
                    stats["losses"] += 1
        except ValueError:
            print(Colors.RED + "GeÃ§ersiz giriÅŸ! LÃ¼tfen bir sayÄ± gir." + Colors.RESET)
            time.sleep(0.5)
        except Exception as e:
            print(Colors.RED + f"Beklenmeyen bir hata oluÅŸtu: {e}" + Colors.RESET)
            time.sleep(0.5)

        # Bu input'un yeri deÄŸiÅŸti, artÄ±k her tahmin sonrasÄ± deÄŸil, can bittiÄŸinde veya kazanÄ±ldÄ±ÄŸÄ±nda gelecek.
        # BÃ¶ylece dÃ¶ngÃ¼de gereksiz duraklama olmaz.
        if can <= 0 or tahmin == gizli_sayi: # Oyun bittiÄŸinde
            input(Colors.BLUE + "\nDevam etmek iÃ§in ENTER tuÅŸuna bas..." + Colors.RESET)
            clear_screen()
            save_stats(stats) # Oyun bitince istatistikleri kaydet


# --- Ana MenÃ¼ ---
def main_menu():
    """Oyunun ana menÃ¼sÃ¼nÃ¼ gÃ¶sterir ve kullanÄ±cÄ± seÃ§imlerini yÃ¶netir."""
    stats = load_stats() # Ä°statistikleri baÅŸlangÄ±Ã§ta yÃ¼kle

    # Oyun baÅŸlamadan Ã¶nce aÃ§Ä±lÄ±ÅŸ ekranÄ±nÄ± gÃ¶ster
    display_splash_screen()

    while True:
        # MenÃ¼yÃ¼ bir Ã§erÃ§eve iÃ§inde Ã§izelim
        def menu_options_content():
            print(Colors.GREEN + "1. Oyuna BaÅŸla".ljust(58) + Colors.RESET)
            print(Colors.CYAN + "2. Ä°statistikleri GÃ¶r".ljust(58) + Colors.RESET)
            print(Colors.BLUE + "3. NasÄ±l OynanÄ±r?".ljust(58) + Colors.RESET)
            print(Colors.RED + "4. Ã‡Ä±kÄ±ÅŸ".ljust(58) + Colors.RESET)
            print("\n" + Colors.BRIGHT_BLACK + "Kontrol Paneli V1.2".rjust(58) + Colors.RESET) # Alt bilgi

        # Ana menÃ¼yÃ¼ Ã§izmeden Ã¶nce hoÅŸ geldin iÃ§eriÄŸini gÃ¶sterelim
        draw_frame("ANA MENÃœ", lambda: oyun_karsilama_content(), Colors.CYAN)
        # ArdÄ±ndan menÃ¼ seÃ§eneklerini ve input'u alalÄ±m
        draw_frame("ANA MENÃœ", lambda: menu_options_content(), Colors.CYAN)


        secim = input(Colors.YELLOW + "SeÃ§imin: " + Colors.RESET).strip()

        if secim == '1':
            play_game(stats)
        elif secim == '2':
            draw_frame("OYUN Ä°STATÄ°STÄ°KLERÄ°", lambda: show_stats_content(stats), Colors.CYAN)
        elif secim == '3':
            draw_frame("NASIL OynanÄ±r?", how_to_play_content, Colors.BLUE)
        elif secim == '4':
            clear_screen()
            print_slowly(Colors.WHITE + "\nGÃ¼le gÃ¼le! Tekrar bekleriz. ðŸš€" + Colors.RESET, delay=0.05)
            break
        else:
            clear_screen()
            print(Colors.RED + "GeÃ§ersiz seÃ§im. LÃ¼tfen 1, 2, 3 veya 4 girin." + Colors.RESET)
            time.sleep(1)
            clear_screen()

# Oyunu baÅŸlat
if __name__ == "__main__":
    clear_screen() # Program baÅŸlangÄ±cÄ±nda ekranÄ± temizle
    sys.stdout.write(Colors.BG_BLACK) # Terminal arka planÄ±nÄ± siyaha ayarla (EÄŸer destekleniyorsa)
    sys.sdout.flush()
    main_menu()
    sys.stdout.write(Colors.RESET) # Ã‡Ä±kÄ±ÅŸta renkleri sÄ±fÄ±rla
    sys.stdout.flush()
